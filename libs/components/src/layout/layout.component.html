<ng-container
  *ngIf="{
    open: sidebarService.open$ | async,
    isOverlay: sidebarService.isOverlay$ | async
  } as data"
>
  <div class="tw-group tw-flex tw-w-full" [ngClass]="data.open ? 'sidebar-open' : 'sidebar-closed'">
    <aside
      id="bit-sidebar"
      class="tw-fixed tw-inset-y-0 tw-left-0 tw-z-20 tw-flex tw-h-screen tw-flex-col tw-overflow-auto tw-bg-background-alt3 tw-pt-7 group-[.sidebar-open]:tw-w-60 md:tw-sticky"
      [ngStyle]="
        variant === 'secondary' && {
          '--color-text-alt2': 'var(--color-text-main)',
          '--color-background-alt3': 'var(--color-secondary-100)',
          '--color-background-alt4': 'var(--color-secondary-300)',
          '--color-secondary-300': 'var(--color-secondary-500)'
        }
      "
      [cdkTrapFocus]="data.isOverlay"
      [attr.role]="data.isOverlay ? 'dialog' : null"
      [attr.aria-modal]="data.isOverlay"
      (keydown)="handleKeyDown($event)"
    >
      <ng-content select="[slot=sidebar]"></ng-content>
      <div class="tw-sticky tw-bottom-0 tw-left-0 tw-mt-auto tw-w-full tw-bg-background-alt3">
        <div class="tw-mx-0.5 tw-my-4 tw-w-[3.75rem]">
          <button
            id="bit-sidebar-toggle-button"
            type="button"
            class="tw-mx-auto tw-block tw-max-w-fit"
            [bitIconButton]="data.open ? 'bwi-angle-left' : 'bwi-angle-right'"
            buttonType="light"
            size="small"
            (click)="sidebarService.toggle()"
            [attr.aria-label]="'toggleSideNavigation' | i18n"
            [attr.aria-expanded]="data.open"
            aria-controls="bit-sidebar"
          ></button>
        </div>
      </div>
    </aside>
    <main
      class="tw-ml-14 tw-h-screen tw-min-w-0 tw-flex-1 tw-overflow-auto tw-bg-background tw-p-6 md:tw-ml-0"
    >
      <ng-content></ng-content>
      <div
        class="tw-pointer-events-none tw-fixed tw-inset-0 tw-z-10 tw-bg-black tw-bg-opacity-0 motion-safe:tw-transition-colors md:tw-hidden"
        [ngClass]="[data.open ? 'tw-bg-opacity-30 md:tw-bg-opacity-0' : 'tw-bg-opacity-0']"
      >
        <div
          *ngIf="data.open"
          (click)="sidebarService.toggle()"
          class="tw-pointer-events-auto tw-h-full tw-w-full"
        ></div>
      </div>
    </main>
  </div>
</ng-container>
