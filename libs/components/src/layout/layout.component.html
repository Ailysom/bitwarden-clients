<ng-container
  *ngIf="{
    open: sidebarService.open$ | async,
    isOverlay: sidebarService.isOverlay$ | async
  } as data"
>
  <div
    class="tw-fixed tw-z-50 tw-w-full tw-flex tw-justify-center tw-opacity-0 focus-within:tw-opacity-100 tw-pointer-events-none focus-within:tw-pointer-events-auto"
  >
    <nav class="tw-bg-background-alt3 tw-rounded-md tw-rounded-t-none tw-py-2 tw-text-alt2">
      <a
        bitLink
        class="tw-mx-6 focus-visible:before:!tw-ring-0"
        [fragment]="mainContentId"
        [routerLink]="[]"
        (click)="focusMainContent()"
        linkType="light"
        >{{ "skipToContent" | i18n }}</a
      >
    </nav>
  </div>
  <div class="tw-group tw-flex tw-w-full" [ngClass]="data.open ? 'sidebar-open' : 'sidebar-closed'">
    <aside
      id="bit-sidebar"
      class="tw-fixed tw-inset-y-0 tw-left-0 tw-z-20 tw-flex tw-h-screen tw-flex-col tw-overscroll-none tw-overflow-auto tw-bg-background-alt3 group-[.sidebar-open]:tw-w-60 md:tw-sticky"
      [ngStyle]="
        variant === 'secondary' && {
          '--color-text-alt2': 'var(--color-text-main)',
          '--color-background-alt3': 'var(--color-secondary-100)',
          '--color-background-alt4': 'var(--color-secondary-300)',
          '--color-secondary-300': 'var(--color-secondary-500)'
        }
      "
      [cdkTrapFocus]="data.isOverlay"
      [attr.role]="data.isOverlay ? 'dialog' : null"
      [attr.aria-modal]="data.isOverlay"
      (keydown)="handleKeyDown($event)"
    >
      <ng-content select="[slot=sidebar]"></ng-content>
      <div class="tw-sticky tw-bottom-0 tw-left-0 tw-mt-auto tw-w-full tw-bg-background-alt3">
        <bit-nav-divider></bit-nav-divider>
        <div class="tw-mx-0.5 tw-my-4 tw-w-[3.75rem]">
          <button
            id="bit-sidebar-toggle-button"
            type="button"
            class="tw-mx-auto tw-block tw-max-w-fit"
            [bitIconButton]="data.open ? 'bwi-angle-left' : 'bwi-angle-right'"
            buttonType="light"
            size="small"
            (click)="sidebarService.toggle()"
            [attr.aria-label]="'toggleSideNavigation' | i18n"
            [attr.aria-expanded]="data.open"
            aria-controls="bit-sidebar"
          ></button>
        </div>
      </div>
    </aside>
    <main
      [id]="mainContentId"
      tabindex="-1"
      class="tw-ml-14 tw-h-screen tw-min-w-0 tw-flex-1 tw-overscroll-contain tw-overflow-auto tw-bg-background tw-p-6 md:tw-ml-0"
    >
      <ng-content></ng-content>
      <div
        class="tw-pointer-events-none tw-fixed tw-inset-0 tw-z-10 tw-bg-black tw-bg-opacity-0 motion-safe:tw-transition-colors md:tw-hidden"
        [ngClass]="[data.open ? 'tw-bg-opacity-30 md:tw-bg-opacity-0' : 'tw-bg-opacity-0']"
      >
        <div
          *ngIf="data.open"
          (click)="sidebarService.toggle()"
          class="tw-pointer-events-auto tw-h-full tw-w-full"
        ></div>
      </div>
    </main>
  </div>
</ng-container>
